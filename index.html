<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MINER V1.1</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020205; --card: #0a0a15; --acc: #00ff88; --gold: #ffd700; }
        * { box-sizing: border-box; font-family: 'Rajdhani', sans-serif; color: #fff; margin: 0; padding: 0; outline: none; }
        body { background: var(--bg); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--card); padding: 30px; border: 2px solid var(--acc); border-radius: 10px; width: 90%; max-width: 350px; text-align: center; }

        header { background: #000; padding: 10px; border-bottom: 2px solid var(--acc); display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .stat-box { background: #080808; padding: 5px; border-radius: 4px; border: 1px solid #222; font-size: 12px; }
        .stat-box b { color: var(--acc); }

        .prog-container { grid-column: span 2; position: relative; height: 22px; background: #111; border-radius: 11px; overflow: hidden; border: 1px solid #333; margin-top: 5px; }
        .prog-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00aaff); width: 0%; transition: 0.2s; }
        .prog-text { position: absolute; width: 100%; text-align: center; top: 3px; font-weight: bold; font-size: 11px; text-shadow: 1px 1px #000; }

        .main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .tab { display: none; }
        .tab.active { display: block; }

        .egg-item { background: #0d0d1a; border: 1px solid #333; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .pet-shelf { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 5px; margin-top: 15px; }
        .pet-unit { font-size: 18px; text-align: center; background: #111; border-radius: 4px; padding: 5px; border: 1px solid #222; position: relative; }
        .pet-mult { font-size: 9px; color: var(--gold); display: block; }

        .btn { background: var(--acc); color: #000; font-weight: 700; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        .btn:disabled { opacity: 0.3; }

        nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: #000; display: flex; border-top: 2px solid #111; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.4; }
        .nav-item.active { opacity: 1; color: var(--acc); }

        #chat-content { height: 180px; background: #050505; border: 1px solid #222; overflow-y: auto; padding: 10px; font-size: 13px; margin-bottom: 5px; border-radius: 5px; }
        .rank-table { width: 100%; border-collapse: collapse; background: #080808; }
        .rank-table td { padding: 8px; border-bottom: 1px solid #111; font-size: 14px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h2 style="font-family: Orbitron; margin-bottom: 15px; color: var(--acc);">MINER GOD</h2>
        <input id="user" placeholder="USU√ÅRIO" style="background:#000; border:1px solid #333; padding:12px; width:100%; margin-bottom:10px; border-radius:5px;">
        <input id="pass" type="password" placeholder="SENHA" style="background:#000; border:1px solid #333; padding:12px; width:100%; margin-bottom:10px; border-radius:5px;">
        <button class="btn" style="width: 100%" onclick="game.start()">ENTRAR</button>
    </div>
</div>

<header>
    <div class="stat-box">üí∞ GOLD: <b id="h-gold">0</b></div>
    <div class="stat-box">üåç MUNDO: <b id="h-w">1</b></div>
    <div class="stat-box">üéí BAG: <b id="h-bag">0</b></div>
    <div class="stat-box">‚ú® RB: <b id="h-rb">0</b>/<span id="h-rb-need">1</span></div>
    <div class="prog-container">
        <div id="prog-fill" class="prog-fill"></div>
        <div class="prog-text">XP MUNDO: <span id="h-lv">0</span> / 50</div>
    </div>
</header>

<div class="main">
    <div id="t-mine" class="tab active">
        <center>
            <div id="mine-btn" style="font-size: 100px; margin: 15px 0; cursor: pointer;" onclick="game.mine()">‚õèÔ∏è</div>
            <button class="btn" style="width:100%; background: var(--gold); margin-bottom: 10px;" onclick="game.sell()">VENDER MANUAL</button>
            <div style="background: #111; padding: 15px; border-radius: 10px; text-align: left; font-size: 14px;">
                <label style="display:flex; justify-content:space-between; margin-bottom:8px;">AUTO-CLICK <input type="checkbox" id="auto-click"></label>
                <label style="display:flex; justify-content:space-between; margin-bottom:8px;">AUTO-REBIRTH <input type="checkbox" id="auto-rb"></label>
                <label style="display:flex; justify-content:space-between;">AUTO-SELL <input type="checkbox" id="auto-sell"></label>
            </div>
        </center>
    </div>

    <div id="t-eggs" class="tab">
        <h3>OVOS DA LOJA</h3>
        <div id="egg-list"></div>
        <h3 style="margin-top:20px">PETS COLECIONADOS</h3>
        <div id="pet-shelf" class="pet-shelf"></div>
    </div>

    <div id="t-social" class="tab">
        <h3>üèÜ RANKING GLOBAL</h3>
        <table class="rank-table" id="rank-list"></table>
        <h3 style="margin-top:20px">üí¨ CHAT</h3>
        <div id="chat-content"></div>
        <div style="display:flex; gap:5px;">
            <input id="chat-msg" style="flex:1; background:#000; border:1px solid #333; padding:10px; border-radius:5px;" placeholder="Mensagem...">
            <button class="btn" onclick="game.sendChat()">ENVIAR</button>
        </div>
    </div>
</div>

<nav>
    <div class="nav-item active" onclick="game.tab('t-mine', this)">‚õèÔ∏è<span>MINA</span></div>
    <div class="nav-item" onclick="game.tab('t-eggs', this)">ü•ö<span>PETS</span></div>
    <div class="nav-item" onclick="game.tab('t-social', this)">üí¨<span>SOCIAL</span></div>
</nav>

<script>
const game = {
    data: { u:'', p:'', gold:0, bag:0, w:1, lv:0, rb:0, pets:{}, last: Date.now() },
    suffixes: ["", "K", "M", "B", "T", "QD", "QT", "SX", "SP", "OC", "NO", "DC"],
    petIcons: ["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üê§","ü¶Ö","ü¶â","ü¶á","üê∫","üêó","üê¥","ü¶Ñ","üêù","ü™≤","ü¶ã","ü¶é","ü¶Ä","ü¶û","ü¶ê","ü¶ë","üêô","üê†","üêü","üê°","üê¨","üê≥","üêã","ü¶à","üêä","üêÖ","üêÜ","ü¶ì","ü¶ç","ü¶ß","ü¶£","üêò","üê™","üê´","ü¶í","ü¶ò","ü¶•","ü¶¶","ü¶´","ü¶°","ü¶®","üêÅ","üêÄ","üêøÔ∏è","ü¶î","ü¶é","üêç","üê¢","ü¶ñ","ü¶ï","üêô","ü¶ë","ü¶ê","ü¶Ä","üê°","üê†","üêü","üê¨","üê≥","üêã","ü¶à","üêä","üêÖ","üêÜ","ü¶ì","ü¶ç","ü¶ß","ü¶£","üêò","üê™","üê´","ü¶í","ü¶ò","ü¶•","ü¶¶","ü¶´","ü¶°","ü¶®","üê¶","üê§","üê£","üê•","ü¶Ö","ü¶â","üê¶","üê§","üê£","üê•","ü¶Ö","ü¶â","üêú","üêù","ü™≤","ü¶ã","üêõ","ü¶ó","üï∑Ô∏è","üï∏Ô∏è","ü¶Ç","ü¶ü","ü™±","ü¶†","üêæ","üçì","üçå","üçé","ü•≠","üçâ","üåΩ","üçï","üçî","üçü","üå≠","üçø","ü•ì","üç≥","üßá","ü•û","üßà","ü•ê","ü•®","ü•Ø","ü•ñ","üßÄ","ü•ó","ü•™","üåÆ","üåØ","üç±","ü•ü","üç¢","üç£","üç§","üç•","ü•†","ü•°","üç¶","üçß","üç®","üç©","üç™","üéÇ","üç∞","üßÅ","ü•ß","üç´","üç¨","üç≠","üçÆ","üçØ","üç∑","üç∏","üçπ","üç∫","üßâ","ü•§","üßÉ","ü•õ","‚òï","üçµ","üç∂","üßä"],

    start() {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value.trim();
        if(!u || !p) return;
        this.data.u = u; this.data.p = p;
        let save = localStorage.getItem('MG_FINAL_'+u);
        if(save) {
            let d = JSON.parse(save);
            if(d.p === p) {
                // GANHO OFFLINE
                const offTime = (Date.now() - d.last) / 1000;
                if(offTime > 30) {
                    let rate = (d.rb + 1) * d.w * 2;
                    let gain = offTime * rate;
                    d.gold += gain;
                    alert("Bem vindo de volta! Voc√™ ganhou $" + this.f(gain) + " enquanto estava fora.");
                }
                this.data = d;
            } else return alert("Senha incorreta!");
        }
        document.getElementById('auth-screen').style.display = 'none';
        this.initNet();
        this.update();
        setInterval(() => this.loop(), 100);
        setInterval(() => this.sync(), 5000);
    },

    initNet() {
        this.ably = new Ably.Realtime('wpgTTw.ROsKoQ:3G5iFq9cMkZppCZ4aicBOwDhAGs69lV0Egd55FistlQ');
        this.ch = this.ably.channels.get('mg_vFinal');
        this.ch.subscribe('msg', m => {
            let c = document.getElementById('chat-content');
            c.innerHTML += `<div><b style="color:var(--acc)">${m.data.u}:</b> ${m.data.t}</div>`;
            c.scrollTop = c.scrollHeight;
        });
        this.ch.subscribe('rank', m => {
            if(!window.rk) window.rk = {};
            window.rk[m.data.u] = m.data.g;
            this.drawRank();
        });
    },

    f(n) {
        if (n < 1000) return Math.floor(n);
        let i = Math.floor(Math.log10(n) / 3);
        return (n / Math.pow(1000, i)).toFixed(2) + (this.suffixes[i] || "");
    },

    mine() {
        let m = 1 + (this.data.rb * 5);
        Object.values(this.data.pets).forEach(p => m += (p.q * p.m));
        this.data.bag += m;
        this.data.lv += (0.2 / this.data.w);
        if(this.data.lv >= 50) this.data.lv = 50;
        this.update();
    },

    sell() {
        if(this.data.bag <= 0) return;
        this.data.gold += this.data.bag * (this.data.w * 10);
        this.data.bag = 0;
        this.update();
    },

    loop() {
        if(document.getElementById('auto-click').checked) this.mine();
        if(document.getElementById('auto-sell').checked && this.data.bag > 0) this.sell();
        if(document.getElementById('auto-rb').checked && this.data.lv >= 50) {
            this.data.rb++;
            if(this.data.rb >= this.data.w) { this.data.w++; this.data.rb = 0; }
            this.data.lv = 0;
            this.update();
        }
        this.data.last = Date.now();
        localStorage.setItem('MG_FINAL_'+this.data.u, JSON.stringify(this.data));
    },

    buyEgg(wIdx) {
        let cost = 100 * Math.pow(20, wIdx);
        if(this.data.gold < cost) return;
        this.data.gold -= cost;
        let icon = this.petIcons[(wIdx * 5) + Math.floor(Math.random() * 5)] || "üíé";
        if(!this.data.pets[icon]) this.data.pets[icon] = { q:1, m: (wIdx + 1) * 15 };
        else this.data.pets[icon].q++;
        this.update();
    },

    update() {
        document.getElementById('h-gold').innerText = this.f(this.data.gold);
        document.getElementById('h-bag').innerText = this.f(this.data.bag);
        document.getElementById('h-w').innerText = this.data.w;
        document.getElementById('h-lv').innerText = Math.floor(this.data.lv);
        document.getElementById('h-rb').innerText = this.data.rb;
        document.getElementById('h-rb-need').innerText = this.data.w;
        document.getElementById('prog-fill').style.width = (this.data.lv / 50 * 100) + "%";
        
        let eggs = "";
        for(let i=0; i<this.data.w; i++) {
            let cost = 100 * Math.pow(20, i);
            eggs += `<div class="egg-item"><span>MUNDO ${i+1}</span><button class="btn" onclick="game.buyEgg(${i})" ${this.data.gold < cost ? 'disabled':''}>$${this.f(cost)}</button></div>`;
        }
        document.getElementById('egg-list').innerHTML = eggs;

        document.getElementById('pet-shelf').innerHTML = Object.entries(this.data.pets).map(([i,p]) => `
            <div class="pet-unit">${i} <small>x${p.q}</small><span class="pet-mult">+${this.f(p.q*p.m)}</span></div>
        `).join('');
    },

    sync() { if(this.data.u) this.ch.publish('rank', { u: this.data.u, g: this.data.gold }); },

    sendChat() {
        let i = document.getElementById('chat-msg');
        if(i.value) { this.ch.publish('msg', { u: this.data.u, t: i.value }); i.value = ""; }
    },

    drawRank() {
        let sorted = Object.entries(window.rk).sort((a,b) => b[1]-a[1]).slice(0,10);
        document.getElementById('rank-list').innerHTML = sorted.map((p,i) => `<tr><td>#${i+1} ${p[0]}</td><td align="right">$${this.f(p[1])}</td></tr>`).join('');
    },

    tab(id, btn) {
        document.querySelectorAll('.tab, .nav-item').forEach(x => x.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }
};
</script>
</body>
</html>
